@model IEnumerable<JaggeryAgro.Core.Entities.LaborPayment>
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["Labor Payment List"];
}

<div class="container mt-5">

    <!-- Page Header -->
    <div class="text-center mb-4">
        <h2 class="fw-bold text-white px-4 py-3 d-inline-block rounded shadow-lg"
            style="background: linear-gradient(90deg, #198754, #20c997); font-size:2rem; letter-spacing:1px; text-shadow:1px 1px 2px rgba(0,0,0,0.3);">
            🧑‍🌾 @ViewData["Title"]
        </h2>
    </div>

    <!-- Summary Cards -->
    <div class="row text-center mb-4 g-3">
        <div class="col-md-4">
            <div class="card shadow-sm rounded-4 bg-success text-white h-100">
                <div class="card-body">
                    <h6 class="mb-2">@Localizer["Total Salary"]</h6>
                    <h4 class="fw-bold">₹ @String.Format("{0:}", ViewBag.TotalGross)</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm rounded-4 bg-warning text-dark h-100">
                <div class="card-body">
                    <h6 class="mb-2">@Localizer["Advance Deducted"]</h6>
                    <h4 class="fw-bold">₹ @String.Format("{0:}", ViewBag.TotalAdvance)</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm rounded-4 bg-primary text-white h-100">
                <div class="card-body">
                    <h6 class="mb-2">@Localizer["Net Salary"]</h6>
                    <h4 class="fw-bold">₹ @String.Format("{0:}", ViewBag.TotalNet)</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Form -->
    <form method="get" class="row g-3 mb-4 align-items-end">
        <div class="col-md-3">
            <label class="form-label fw-bold text-white bg-primary px-2 py-1 rounded d-inline-block">
                <i class="bi bi-people-fill me-2"></i> @Localizer["Labor"]
            </label>
            <select name="laborId" class="form-select"
                    asp-items="@(new SelectList(ViewBag.Labors, "Id", "Name", ViewBag.SelectedLabor))">
                <option value="">-- @Localizer["Select Labor"] --</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label fw-bold text-white bg-primary px-2 py-1 rounded d-inline-block">
                <i class="bi bi-calendar-event me-2"></i> @Localizer["From"]
            </label>
            <input type="date" name="from" class="form-control" value="@ViewBag.From" />
        </div>
        <div class="col-md-3">
            <label class="form-label fw-bold text-white bg-primary px-2 py-1 rounded d-inline-block">
                <i class="bi bi-calendar-event me-2"></i> @Localizer["To"]
            </label>
            <input type="date" name="to" class="form-control" value="@ViewBag.To" />
        </div>
        <div class="col-md-3 d-grid">
            <button type="submit" class="btn btn-success btn-lg fw-bold shadow rounded-pill">
                <i class="bi bi-funnel-fill me-2"></i> @Localizer["Filter"]
            </button>
        </div>
    </form>

    <!-- Date Range Display -->
    @if (ViewBag.From != null && ViewBag.To != null)
    {
        <p class="text-muted text-center mb-4">
            <i class="bi bi-calendar3 text-primary"></i>
            @Localizer["Date Range"]: <b>@ViewBag.From</b> @Localizer["to"] <b>@ViewBag.To</b>
        </p>
    }

    <!-- Table -->
    <div class="card shadow-sm rounded-4">
        <div class="card-body p-3">
            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle text-center" id="LaborPaymentsTable">
                    <thead class="table-dark">
                        <tr>
                            <th>@Localizer["Labor Name"]</th>
                            <th>@Localizer["Days/Production/Weight"]</th>
                            <th>@Localizer["Rate"]</th>
                            <th>@Localizer["Total Salary"]</th>
                            <th>@Localizer["Advance"]</th>
                            <th>@Localizer["Net Salary"]</th>
                            <th>@Localizer["Status"]</th>
                            <th>@Localizer["Slip"]</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var p in Model)
                        {
                            <tr>
                                <td>@p.LaborName</td>
                                <td>
                                    @if (p.LaborTypeName.Contains("ऊस तोड", StringComparison.OrdinalIgnoreCase))
                                    {
                                        @String.Format("{0:0.##} टन", p.WorkAmount)
                                    }
                                    else if (p.LaborTypeName.Contains("गुळ तयार", StringComparison.OrdinalIgnoreCase))
                                    {
                                        @String.Format("{0:0.##} युनिट्स", p.WorkAmount)
                                    }
                                    else
                                    {
                                        @(p.AttendanceDays > 0 ? $"{p.AttendanceDays} {Localizer["Days"].Value}" : "-")
                                    }
                                </td>

                                <td>₹ @String.Format("{0:0.##}", p.rate)</td>
                                <td>₹ @String.Format("{0:0.##}", p.GrossAmount)</td>
                                <td>₹ @String.Format("{0:0.##}", p.AdvanceAdjusted)</td>
                                <td><b>₹ @String.Format("{0:0.##}", p.NetAmount)</b></td>
                                <td>
                                    @if (p.IsPaid)
                                    {
                                        <span class="badge bg-success">@Localizer["Paid"]</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">@Localizer["Pending"]</span>
                                    }
                                </td>
                                <td>
                                    @if (!p.IsPaid)
                                    {
                                        <a asp-action="GenerateSlip"
                                           asp-route-laborId="@p.LaborId"
                                           asp-route-from="@ViewBag.From"
                                           asp-route-to="@ViewBag.To"
                                           class="btn btn-sm btn-primary shadow-sm rounded-pill">
                                            <i class="bi bi-file-earmark-text"></i> @Localizer["Generate Slip"]
                                        </a>
                                    }
                                    else
                                    {
                                        <span class="text-muted">@Localizer["Generated"]</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#LaborPaymentsTable').DataTable({
                responsive: true,
                paging: true,
                searching: true,
                ordering: true,
                pageLength: 7,
                language: {
                    search: "@Localizer["Search"]",
                    lengthMenu: "@Localizer["Show _MENU_ entries per page"]",
                    info: "@Localizer["Showing _START_ to _END_ of _TOTAL_ entries"]"
                },
                columnDefs: [{ orderable: false, targets: 7 }]
            });
        });
    </script>
}
