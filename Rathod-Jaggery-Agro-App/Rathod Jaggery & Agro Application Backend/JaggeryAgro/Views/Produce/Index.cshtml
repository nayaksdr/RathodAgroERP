@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model IEnumerable<JaggeryAgro.Core.Entities.JaggeryProduce>

@{
    ViewData["Title"] = Localizer["Title"];
    var query = ViewContext.HttpContext.Request.Query;
}

<div class="container mt-4">

    <!-- Header -->
    <div class="text-center my-4">
        <h2 class="fw-bold text-white bg-primary px-4 py-2 d-inline-block rounded-3 shadow mb-4">
            🍯 @Localizer["HeaderTitle"]
        </h2>
    </div>

    <!-- Filter & Actions -->
    <form method="get" class="row g-2 mb-3 align-items-end">
        <div class="col-md-2 col-6">
            <a asp-action="ExportExcel"
               asp-route-from="@query["from"]"
               asp-route-to="@query["to"]"
               class="btn btn-outline-success w-100 shadow-sm">
                <i class="bi bi-file-earmark-excel"></i> @Localizer["ExportExcel"]
            </a>
        </div>

        <div class="col-md-3 col-6">
            <label class="form-label fw-bold">@Localizer["FromDate"]</label>
            <input type="date" name="from" value="@query["from"]" class="form-control" />
        </div>

        <div class="col-md-3 col-6">
            <label class="form-label fw-bold">@Localizer["ToDate"]</label>
            <input type="date" name="to" value="@query["to"]" class="form-control" />
        </div>

        <div class="col-md-2 col-6">
            <button type="submit" class="btn btn-primary w-100 shadow-sm">
                <i class="bi bi-funnel"></i> @Localizer["Filter"]
            </button>
        </div>

        <div class="col-md-2 col-6">
            <a asp-action="Create" class="btn btn-success w-100 shadow-sm">
                <i class="bi bi-plus-circle"></i> @Localizer["AddNewRecord"]
            </a>
        </div>
    </form>

    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-6 col-sm-12">
            <div class="card text-white bg-primary shadow-lg border-0 rounded-4 h-100">
                <div class="card-body d-flex justify-content-between align-items-center p-4">
                    <div>
                        <h6 class="fw-bold text-uppercase mb-0 text-white opacity-75">@Localizer["TotalBellyCount"]</h6>
                        <h3 class="fw-bolder mb-0 fs-1">@ViewBag.TotalUnitPrice</h3>
                    </div>
                    <i class="bi bi-box-seam display-4 opacity-75"></i>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-sm-12">
            <div class="card text-white bg-success shadow-lg border-0 rounded-4 h-100">
                <div class="card-body d-flex justify-content-between align-items-center p-4">
                    <div>
                        <h6 class="fw-bold text-uppercase mb-0 text-white opacity-75">@Localizer["TotalProductionKg"]</h6>
                        <h3 class="fw-bolder mb-0 fs-1">@ViewBag.TotalCost</h3>
                    </div>
                    <i class="bi bi-bucket display-4 opacity-75"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="table-responsive shadow-sm rounded-3">
        <table class="table table-bordered table-hover align-middle table-striped" id="JaggeryProduceTable">
            <thead class="table-dark text-center">
                <tr>
                    <th>@Localizer["Date"]</th>
                    <th>@Localizer["BatchNumber"]</th>
                    <th>@Localizer["BellyWeightKg"]</th>
                    <th>@Localizer["BellyCount"]</th>
                    <th>@Localizer["TotalProductionKg"]</th>
                    <th>@Localizer["Quality"]</th>
                    <th>@Localizer["StockKg"]</th>
                    <th>@Localizer["Actions"]</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr class="text-center align-middle">
                        <td>@item.ProducedDate.ToString("dd-MM-yyyy")</td>
                        <td>@item.BatchNumber</td>
                        <td>@item.QuantityKg.ToString("0")</td>
                        <td>@item.UnitPrice.ToString("0")</td>
                        <td>@item.TotalCostSnapshot.ToString("0")</td>
                        <td>@item.QualityGrade</td>
                        <td>@item.StockKg.ToString("0")</td>
                        <td>
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info me-1" title="@Localizer["Details"]">
                                <i class="bi bi-eye"></i>
                            </a>
                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning me-1" title="@Localizer["Edit"]">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <form asp-action="Delete" asp-route-id="@item.Id" method="post" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('@Localizer["DeleteConfirm"].Value');" title="@Localizer["Delete"]">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#JaggeryProduceTable').DataTable({
                responsive: true,
                paging: true,
                searching: true,
                ordering: true,
                pageLength: 5,
                columnDefs: [
                    { orderable: false, targets: 7 }
                ]
            });
        });
    </script>
}
