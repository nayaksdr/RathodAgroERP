<!-- ================= LAYOUT ================= -->
<div class="app-container d-flex">

  <!-- ================= SIDEBAR ================= -->
  <app-sidebar></app-sidebar>

  <!-- ================= MAIN CONTENT ================= -->
  <div class="main-content flex-grow-1" [class.dark]="darkMode">

    <!-- ================= HEADER NAVBAR ================= -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm px-3 fixed-top">
      <a class="navbar-brand d-flex align-items-center gap-2" routerLink="/dashboard">
        <img src="assets/images/logo.png" height="90" alt="Logo">       
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNavbar">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <!-- Dark Mode Toggle -->
          <li class="nav-item ms-3">
            <button class="btn btn-outline-light btn-sm" type="button" (click)="toggleTheme()">
              <i class="bi" [ngClass]="darkMode ? 'bi-sun-fill' : 'bi-moon-fill'"></i>
            </button>
          </li>
        </ul>
      </div>
    </nav>

    <!-- ================= DASHBOARD CONTENT ================= -->
    <main class="pt-5 mt-4 px-3">
      <div class="container-fluid py-4" *ngIf="data; else loading">

        <!-- TITLE -->
        <div class="dashboard-banner text-center mb-5">
            <div class="header-overlay py-5">
                  <span class="badge-agro mb-2">Operational Excellence</span>
    
    <h2 class="fw-bold text-white mb-2 main-title">
      <i class="bi bi-speedometer2 me-2 gold-icon"></i>
      Rathod Jaggery & Agro Dashboard
    </h2>
    
    <div class="d-flex justify-content-center align-items-center">
      <span class="divider-line"></span>
      <p class="text-white-50 mx-3 mb-0">Real-time daily operational insights</p>
      <span class="divider-line"></span>
    </div>
  </div>
</div>
        <!-- KPI CARDS -->
        <div class="row g-4 mb-5">
          <div class="col-6 col-md-4 col-xl-2" *ngFor="let kpi of kpis">
            <div 
              class="card shadow-sm text-center p-3 h-100 animate__animated animate__fadeInUp kpi-card"
              [ngStyle]="{'border-top': '4px solid ' + kpi.color}">
              
              <!-- Icon -->
              <div class="mb-2 kpi-icon">
                <i class="bi fs-3" [ngClass]="kpi.icon" [ngStyle]="{'color': kpi.color}"></i>
              </div>

              <!-- Title -->
              <h6 class="text-muted">{{ kpi.title }}</h6>

              <!-- Value -->
              <h3 class="fw-bold" [ngStyle]="{'color': kpi.color}">{{ kpi.val }}</h3>
            </div>
          </div>
        </div>

        <!-- ================= CHARTS ================= -->
        <div class="row g-4">
          <div class="col-12 col-lg-6" *ngFor="let chart of chartMeta">
            <div class="card shadow-sm p-3 animate__animated animate__fadeIn">

              <!-- Chart Header: Icon + Title -->
              <div class="d-flex align-items-center mb-2">
                <i class="bi fs-4 me-2" [ngClass]="chart.icon" [ngStyle]="{'color': chart.color}"></i>
                <h6 class="mb-0">{{ chart.title }}</h6>
              </div>

              <!-- Chart Canvas -->
              <div class="chart-container">
                <canvas [id]="chart.id"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- ================= MEMBER PIE CHARTS ================= -->
        <div class="row mt-4" *ngIf="data?.memberSummary?.length">
          <div class="col-12 mb-3">
            <h4 class="text-white">
              <i class="bi bi-people-fill me-2"></i>
              Member Summary
            </h4>
          </div>

          <div class="col-12 col-md-6 col-lg-4" *ngFor="let m of data.memberSummary">
            <div class="card shadow-sm p-3 text-center animate__animated animate__fadeInUp">

              <!-- Member Name -->
              <h6 class="fw-bold mb-3">{{ m.name }}</h6>

              <!-- Pie Chart Canvas -->
              <div class="chart-container">
                <canvas [id]="'pieChart_' + m.memberId"></canvas>
              </div>

              <!-- Member Summary -->
              <div class="mt-3 small text-muted">
                <div>Paid: ₹ {{ m.splitwisePaid }}</div>
                <div>Earned: ₹ {{ m.jaggeryEarned }}</div>
                <div>Net Balance: ₹ {{ m.netBalance }}</div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- LOADING -->
      <ng-template #loading>
        <div class="container text-center py-5">
          <div class="spinner-border text-primary"></div>
          <p class="mt-2">Loading dashboard data...</p>
        </div>
      </ng-template>

      <app-footer></app-footer>
    </main>
  </div>
</div>
