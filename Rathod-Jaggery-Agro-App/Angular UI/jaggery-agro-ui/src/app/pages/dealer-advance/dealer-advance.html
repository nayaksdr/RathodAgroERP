<div class="dealer-advance container-fluid">

  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-end mb-4 gap-3 border-bottom pb-3">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item text-primary fw-bold small">
            <mat-icon class="me-1">store</mat-icon> DEALER
          </li>
          <li class="breadcrumb-item active small text-muted">
            <mat-icon class="me-1">payments</mat-icon> ADVANCE PAYMENTS
          </li>
        </ol>
      </nav>
      <h2 class="fw-bold d-flex align-items-center gap-2">
        <mat-icon class="text-primary">account_balance_wallet</mat-icon> Financial Ledger
      </h2>
    </div>

    <div class="d-flex align-items-center gap-3">
      <div class="badge bg-light text-dark shadow-sm p-3 rounded-pill">
        <mat-icon class="me-1 text-primary">format_list_numbered</mat-icon>
        Total Records: <b class="ms-1">{{ list.length }}</b>
      </div>
      <button class="btn btn-primary rounded-pill px-4 shadow-sm" routerLink="/dealer-advance/add">
        <mat-icon class="me-1">add_circle</mat-icon> New Advance
      </button>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm border-0 rounded-4 bg-light">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <div class="text-muted small">Total Advance Amount</div>
            <div class="fs-4 fw-bold text-success">₹ {{ totalAmount | number }}</div>
          </div>
          <mat-icon class="text-success fs-1">currency_rupee</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <mat-card class="shadow-sm border-0 mb-4 rounded-4">
    <mat-card-content>
      <div class="row g-3 align-items-center">
        
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text bg-white"><mat-icon>person_search</mat-icon></span>
            <select class="form-select" [(ngModel)]="filter.dealerId">
              <option value="">All Dealers</option>
              <option *ngFor="let d of dealers" [value]="d.id">{{ d.name }}</option>
            </select>
          </div>
        </div>

        <div class="col-md-3">
          <div class="input-group">
            <span class="input-group-text bg-white"><mat-icon>event</mat-icon></span>
            <input type="date" class="form-control" [(ngModel)]="filter.from">
          </div>
        </div>

        <div class="col-md-3">
          <div class="input-group">
            <span class="input-group-text bg-white"><mat-icon>history</mat-icon></span>
            <input type="date" class="form-control" [(ngModel)]="filter.to">
          </div>
        </div>

        <div class="col-md-2">
          <button class="btn btn-primary w-100 shadow-sm" (click)="search()">
            <mat-icon class="me-1">search</mat-icon> Search
          </button>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
    <div *ngIf="loading" class="text-center p-5">
      <div class="spinner-border text-primary"></div>
      <div class="mt-2 text-muted">Loading records...</div>
    </div>

    <div *ngIf="!loading" class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-primary">
          <tr>
            <th class="ps-3"><mat-icon class="tiny-icon">tag</mat-icon> #</th>
            <th><mat-icon class="tiny-icon">person</mat-icon> Dealer Name</th>
            <th><mat-icon class="tiny-icon">payments</mat-icon> Amount</th>
            <th><mat-icon class="tiny-icon">account_balance_wallet</mat-icon> Mode</th>
            <th><mat-icon class="tiny-icon">image</mat-icon> Proof</th>
            <th><mat-icon class="tiny-icon">admin_panel_settings</mat-icon> Paid By</th>
            <th class="text-center"><mat-icon class="tiny-icon">settings</mat-icon> Actions</th>
          </tr>
        </thead>

      <tbody *ngIf="paginatedData && paginatedData.length > 0; else noData">
  <tr *ngFor="let item of paginatedData; let i = index">
    <td class="ps-3 text-muted fw-bold">{{ (page - 1) * pageSize + i + 1 }}</td>
    
    <td>
      <div class="fw-bold text-dark">{{ item.dealerName }}</div>
      <div class="small text-muted">{{ item.paymentDate | date:'dd MMM yyyy' }}</div>
      <div *ngIf="item.remarks" class="small text-secondary italic">"{{ item.remarks }}"</div>
    </td>

    <td><div class="fw-bold text-success">₹ {{ item.amount | number }}</div></td>

    <td>
      <span class="badge rounded-pill px-2 py-1" 
        [ngClass]="{'bg-success': item.paymentMode === 'Cash', 
                    'bg-info': item.paymentMode === 'Bank', 
                    'bg-warning text-dark': item.paymentMode === 'UPI'}">
        {{ item.paymentMode }}
      </span>
    </td>

    <td>
      <img *ngIf="item.proofImage" [src]="item.proofImage" 
           (click)="selectedImage = item.proofImage"
           class="img-thumbnail" style="height: 40px; cursor: zoom-in;">
      <span *ngIf="!item.proofImage" class="text-muted small">No Proof</span>
    </td>

    <td>
      <div class="small fw-semibold">{{ item.paidByName }}</div>
    </td>

    <td class="text-center">
      <button mat-icon-button color="primary" (click)="edit(item.id)">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="delete(item.id)">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </tr>
</tbody>

<ng-template #noData>
  <tr>
    <td colspan="7" class="text-center p-5 text-muted">
      <mat-icon style="font-size:40px; height: 40px; width: 40px;">inventory_2</mat-icon>
      <p class="mt-2">No advance payments found.</p>
    </td>
  </tr>
</ng-template>
      </table>
    </div>
  </div>
  
  </div>