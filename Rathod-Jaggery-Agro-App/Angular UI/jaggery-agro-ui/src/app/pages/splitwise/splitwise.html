<div class="splitwise-page">
  <nav class="navbar navbar-light bg-glass mb-4 px-4 shadow-sm rounded-4">
    <div class="container-fluid px-0">
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Inter:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
  .brand-container {
    font-family: 'Poppins', sans-serif;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #fff;
    border-bottom: 1px solid #eee;
  }
  .brand-text {
    letter-spacing: -0.5px;
    font-weight: 700;
  }
  .cart-wrapper {
    position: relative;
    cursor: pointer;
    transition: transform 0.2s ease;
    padding: 8px;
    border-radius: 8px;
    background: #f8f9fa;
  }
  .cart-wrapper:hover {
    transform: scale(1.05);
    background: #e9ecef;
  }
  .cart-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: #5d5fef; /* Professional Blue/Purple */
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 0.7rem;
    font-weight: bold;
    border: 2px solid #fff;
  }
  
  /* Responsive text for smaller screens */
  @media (max-width: 576px) {
    .brand-text { font-size: 1.25rem; }
    .text-muted { font-size: 0.7rem; }
  }
</style>

<div class="brand-container">
  <div>
    <h2 class="brand-text mb-0">
      Rathod Jaggery <span class="text-primary" style="color: #5d5fef !important;">Splitwise</span>
    </h2>
    <p class="text-muted small mb-0" style="font-family: 'Inter', sans-serif;">
      Business Expense Management System
    </p>
  </div>

  <div class="cart-wrapper">
    <i class="fas fa-shopping-cart fa-lg text-dark"></i>
    <span class="cart-badge">3</span>
  </div>
</div>
      <div class="d-flex gap-3">
        <button class="btn btn-export shadow-sm" (click)="exportPdf()">
          <mat-icon>picture_as_pdf</mat-icon> Report
        </button>
        <button class="btn btn-primary rounded-pill px-4 shadow-sm action-btn" data-bs-toggle="modal" data-bs-target="#expenseModal">
          <mat-icon>add</mat-icon> Add Expense
        </button>
        <div class="modal fade" id="expenseModal" tabindex="-1" aria-labelledby="expenseModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      
      <div class="modal-header bg-light rounded-top-4 border-bottom-0 p-4">
        <h5 class="modal-title fw-bold d-flex align-items-center" id="expenseModalLabel">
          <mat-icon class="me-2 text-primary">{{ isEditMode ? 'edit_square' : 'add_circle' }}</mat-icon>
          {{ isEditMode ? 'Update Expense' : 'Add New Expense' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="resetExpenseForm()"></button>
      </div>

      <div class="modal-body p-4">
        <form [formGroup]="expenseForm">
          
          <div class="mb-4">
            <label class="form-label fw-semibold">Amount</label>
            <div class="input-group">
              <span class="input-group-text bg-white border-end-0">₹</span>
              <input type="number" formControlName="amount" class="form-control border-start-0 ps-0" placeholder="0.00">
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">Paid By</label>
              <select formControlName="paidById" class="form-select shadow-none">
                <option value="" disabled selected>Select Person</option>
                <option *ngFor="let m of members" [value]="m.id">{{ m.name }}</option>
              </select>
            </div>

            <div class="col-md-6 mb-4">
              <label class="form-label fw-semibold">Category</label>
              <select formControlName="expenseTypeId" class="form-select shadow-none">
  <option [ngValue]="null" disabled>Select Type</option>
  
  <option *ngFor="let type of expenseTypes" [value]="type.id">
    {{ type.name }}
  </option>
</select>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label fw-semibold">Payment Mode</label>
            <div class="d-flex gap-3 mt-1">
              <div class="form-check custom-radio">
                <input class="form-check-input" type="radio" value="Cash" formControlName="paymentMode" id="payCash">
                <label class="form-check-label" for="payCash">Cash</label>
              </div>
              <div class="form-check custom-radio">
                <input class="form-check-input" type="radio" value="UPI" formControlName="paymentMode" id="payUPI">
                <label class="form-check-label" for="payUPI">UPI / Online</label>
              </div>
            </div>
          </div>

          <div class="mb-3 animate-fade" *ngIf="expenseForm.get('paymentMode')?.value !== 'Cash'">
            <label class="form-label fw-semibold d-flex align-items-center">
              <mat-icon class="me-1" style="font-size: 18px;">receipt_long</mat-icon> Upload Receipt
            </label>
            <input type="file" class="form-control" (change)="onFileSelected($event)" accept="image/*,.pdf">
            <small class="text-muted">Required for Online/UPI payments.</small>
          </div>

        </form>
      </div>

      <div class="modal-footer border-top-0 p-4 pt-0">
        <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal" (click)="resetExpenseForm()">Cancel</button>
        <button type="button" class="btn btn-primary rounded-pill px-4 d-flex align-items-center shadow-sm" 
                [disabled]="expenseForm.invalid || isLoading" (click)="saveExpense()">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
          {{ isEditMode ? 'Update' : 'Add' }} Expense
        </button>
      </div>

    </div>
  </div>
</div>
        <button class="btn btn-dark rounded-pill px-4 shadow-sm action-btn" data-bs-toggle="modal" data-bs-target="#memberModal">
          <mat-icon>person_add</mat-icon> Add Member
        </button>
        <div class="modal fade" id="memberModal" tabindex="-1" aria-labelledby="memberModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm"> <div class="modal-content border-0 shadow-lg rounded-4">
      
      <div class="modal-header bg-dark text-white rounded-top-4 border-bottom-0 p-3">
        <h5 class="modal-title fw-bold d-flex align-items-center" id="memberModalLabel">
          <mat-icon class="me-2">person_add</mat-icon>
          Add New Member
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" (click)="resetMemberForm()"></button>
      </div>

      <div class="modal-body p-4">
        <form [formGroup]="memberForm">
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted">Full Name</label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0">
                <mat-icon style="font-size: 18px; width: 18px; height: 18px;">badge</mat-icon>
              </span>
              <input type="text" formControlName="name" class="form-control border-start-0" placeholder="e.g. राम शिंदे">
            </div>
            <div *ngIf="memberForm.get('name')?.touched && memberForm.get('name')?.invalid" class="text-danger small mt-1">
              Name is required.
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer border-top-0 p-3">
        <button type="button" class="btn btn-light rounded-pill px-3" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-dark rounded-pill px-4 shadow-sm" 
                [disabled]="memberForm.invalid || isMemberLoading" (click)="saveMember()">
          <span *ngIf="isMemberLoading" class="spinner-border spinner-border-sm me-1"></span>
          Save Member
        </button>
      </div>

    </div>
  </div>
</div>
      </div>
    </div>
  </nav>
<div class="row g-4 mb-4">
  <div class="col-12 col-sm-6 col-xl-3">
    <div class="stat-card glass-morph primary-gradient">
      <div class="stat-content">
        <p class="stat-label">Total Spent</p>
        <h2 class="stat-value">₹{{ calculateGrandTotal() | number }}</h2>
      </div>
      <div class="stat-icon-wrapper">
        <mat-icon>payments</mat-icon>
      </div>
    </div>
  </div>

  <div class="col-12 col-sm-6 col-xl-3">
    <div class="stat-card glass-morph info-border">
      <div class="stat-content">
        <p class="stat-label-dark">Group Members</p>
        <h2 class="stat-value-dark">{{ members.length }}</h2>
      </div>
      <div class="stat-icon-wrapper text-info">
        <mat-icon>groups</mat-icon>
      </div>
    </div>
  </div>

  <div class="col-12 col-sm-6 col-xl-3">
    <div class="stat-card glass-morph warning-border">
      <div class="stat-content">
        <p class="stat-label-dark">Active Debts</p>
        <h2 class="stat-value-dark">{{ settlements.length }}</h2>
      </div>
      <div class="stat-icon-wrapper text-warning">
        <mat-icon>account_balance</mat-icon>
      </div>
    </div>
  </div>

  <div class="col-12 col-sm-6 col-xl-3">
    <div class="stat-card glass-morph success-border">
      <div class="stat-content">
        <p class="stat-label-dark">Last Update</p>
        <h2 class="stat-value-dark">
          {{ expenses[0]?.date ? (expenses[0]?.date | date:'dd MMM') : 'Today' }}
        </h2>
      </div>
      <div class="stat-icon-wrapper text-success">
        <mat-icon>event_available</mat-icon>
      </div>
    </div>
  </div>
</div>

  <div class="row g-4">
    <div class="col-xl-8">
      <div class="row g-4 mb-4">
        <div class="col-md-6">
          <div class="card chart-card shadow-sm border-0 rounded-4">
            <div class="card-body">
              <h6 class="section-title">Expense Allocation</h6>
              <div style="height:250px"><canvas id="expensePieChart"></canvas></div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card chart-card shadow-sm border-0 rounded-4">
            <div class="card-body">
              <h6 class="section-title">Net Balance Status</h6>
              <div style="height:250px"><canvas id="balanceBarChart"></canvas></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
        <div class="card-header bg-white py-3 px-4 d-flex justify-content-between align-items-center">
          <h5 class="fw-bold mb-0">Transaction History</h5>
          <div class="search-container">
            <mat-icon class="search-icon">search</mat-icon>
            <input type="text" class="search-input" [(ngModel)]="searchText" placeholder="Search by name...">
          </div>
        </div>
        <div class="table-responsive">
          <table class="table align-middle custom-table mb-0">
            <thead>
  <tr class="table-header-row">
    <th>
      <div class="header-content">
        <mat-icon class="header-icon">person</mat-icon>
        <span>Member</span>
      </div>
    </th>
    
    <th>
      <div class="header-content">
        <mat-icon class="header-icon">category</mat-icon>
        <span>Category</span>
      </div>
    </th>
    
    <th>
      <div class="header-content">
        <mat-icon class="header-icon">account_balance_wallet</mat-icon>
        <span>Payment Mode</span>
      </div>
    </th>
    
    <th class="text-end">
      <div class="header-content justify-content-end">
        <mat-icon class="header-icon">payments</mat-icon>
        <span>Amount</span>
      </div>
    </th>
    
    <th class="text-center">
      <div class="header-content justify-content-center">
        <mat-icon class="header-icon">settings</mat-icon>
        <span>Action</span>
      </div>
    </th>
  </tr>
</thead>
            <tbody>
              <tr *ngFor="let ex of filteredExpenses">
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-circle me-3">{{ ex.paidBy?.name?.charAt(0) }}</div>
                    <span class="fw-bold text-dark">{{ ex.paidBy?.name }}</span>
                  </div>
                </td>
                <td><span class="badge badge-soft-primary">{{ ex.expenseType?.name }}</span></td>
                <td>
                  <div class="text-muted small">
                    <mat-icon class="fs-6 align-middle">receipt_long</mat-icon> {{ ex.paymentMode }}
                  </div>
                </td>
                <td class="text-end fw-bold text-primary">₹{{ ex.amount | number }}</td>
                <td class="text-center">
                  <button class="btn btn-update btn-sm me-2" (click)="updateExpense(ex)" data-bs-toggle="modal" data-bs-target="#expenseModal">
                  <mat-icon>edit_note</mat-icon>
                  </button>
                  <button class="btn btn-delete btn-sm" (click)="deleteExpense(ex.id)">
                    <mat-icon>delete_sweep</mat-icon>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-xl-4">
   <div class="card advisor-card shadow-sm border-0 rounded-4 mb-4">
  <div class="card-body p-4">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center">
        <div class="icon-circle bg-info-light me-3">
          <mat-icon class="text-info">psychology</mat-icon>
        </div>
        <div>
          <h6 class="fw-bold text-dark mb-0">Smart Settlement Advisor</h6>
          <small class="text-muted">Optimized debt clearance</small>
        </div>
      </div>
      <span class="badge rounded-pill bg-light text-dark border">{{ settlements.length }} Pending</span>
    </div>

    <div *ngIf="settlements.length > 0; else emptyState">
      <div *ngFor="let s of settlements" class="settle-item animate-in">
        <div class="settle-main">
          <div class="member-node">
            <div class="avatar-sm bg-danger-soft text-danger">{{ s.fromName[0] }}</div>
            <div class="member-info">
              <span class="name">{{ s.fromName }}</span>
              <span class="role">Payer</span>
            </div>
          </div>

          <div class="flow-indicator">
            <span class="amount-badge">₹{{ s.amount | number:'1.2-2' }}</span>
            <mat-icon class="arrow-icon">trending_flat</mat-icon>
          </div>

          <div class="member-node text-end">
            <div class="avatar-sm bg-success-soft text-success">{{ s.toName[0] }}</div>
            <div class="member-info">
              <span class="name">{{ s.toName }}</span>
              <span class="role">Receiver</span>
            </div>
          </div>
        </div>

        <div class="settle-footer mt-3 pt-3 border-top">
           <button class="btn btn-dark w-100 rounded-pill d-flex align-items-center justify-content-center gap-2" 
                   (click)="settlePayment(s.fromId, s.toId, s.amount)">
             <mat-icon style="font-size: 18px;">check_circle</mat-icon>
             Mark as Settled
           </button>
        </div>
      </div>
    </div>

    <ng-template #emptyState>
      <div class="text-center py-5">
        <div class="empty-icon-wrapper mb-3">
          <mat-icon class="text-success" style="font-size: 48px; width: 48px; height: 48px;">verified</mat-icon>
        </div>
        <h5 class="fw-bold">Perfectly Balanced!</h5>
        <p class="text-muted mb-0">No outstanding debts found in this group.</p>
      </div>
    </ng-template>
  </div>
</div>

      <div class="card balance-card border-0 shadow-lg rounded-4 bg-dark text-white overflow-hidden">
        <div class="card-body p-4">
          <h6 class="section-title text-white-50">Group Net Balance</h6>
          <div class="balance-list mt-3">
            <div *ngFor="let m of members" class="balance-row">
              <span class="member-name">{{ m.name }}</span>
              <div class="member-value" [ngClass]="m.balance >= 0 ? 'pos' : 'neg'">
                {{ m.balance >= 0 ? '+' : '' }}₹{{ m.balance | number:'1.1-1' }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>